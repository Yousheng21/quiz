{"ast":null,"code":"import React from \"react\";\nimport saveToLocalStorage, { loadFromLocalStorage, store } from \"../store\";\nimport axios from \"axios\";\nimport { refreshRange, setRange } from \"../reducers/appReducer\";\nexport const startRange = async () => {\n  try {\n    const response = await axios.post('http://localhost:5000/history/range', {});\n    let range = printRange(response.data.response);\n    store.dispatch(setRange(range, top(range)));\n    saveToLocalStorage('range', range);\n    saveToLocalStorage('top', top(range));\n  } catch (e) {\n    console.log(e.response);\n  }\n};\n\nfunction printRange(history) {\n  history = sort(history);\n  let exception = {\n    history: [],\n    biology: [],\n    geography: [],\n    mixed: []\n  };\n  let userId = {\n    history: '1',\n    biology: '1',\n    geography: '1',\n    mixed: '1'\n  };\n  let arr = {\n    history: [],\n    biology: [],\n    geography: [],\n    mixed: []\n  };\n  history.forEach(item => {\n    if (userId[item.kind] !== item.userId && !exception[item.kind].includes(item.userId)) {\n      arr[item.kind].push(item);\n    }\n\n    exception[item.kind].push(item.userId);\n    userId[item.kind] = item.userId;\n  });\n  return {\n    history: arr.history,\n    biology: arr.biology,\n    geography: arr.geography,\n    mixed: arr.mixed\n  };\n}\n\nexport const searchResult = (id, kind) => {\n  let range = store.getState().app.range[kind];\n  range.forEach(item => {\n    if (item._id === id) return item;\n  });\n};\n\nfunction sort(arr) {\n  return arr.sort((a, b) => {\n    return b.result - a.result;\n  });\n}\n\nfunction top(range) {\n  const userId = store.getState().user.currentUser.id;\n  let top = {\n    history: 0,\n    biology: 0,\n    geography: 0,\n    mixed: 0\n  };\n  Object.keys(top).map(item => {\n    writeTop(item);\n  });\n\n  function writeTop(kind) {\n    range[kind].every((item, number) => {\n      if (item.userId === userId) {\n        top[kind] = number + 1;\n        return false;\n      }\n    });\n  }\n\n  return top;\n}\n\nexport const actionRefreshRange = () => {\n  const range = store.getState().app.range;\n  const localRange = loadFromLocalStorage('range');\n  if (Object.keys(range).length === 0 && Object.keys(localRange).length !== 0) store.dispatch(refreshRange());\n};","map":{"version":3,"sources":["F:/Myproject/node1/client/src/actions/range.js"],"names":["React","saveToLocalStorage","loadFromLocalStorage","store","axios","refreshRange","setRange","startRange","response","post","range","printRange","data","dispatch","top","e","console","log","history","sort","exception","biology","geography","mixed","userId","arr","forEach","item","kind","includes","push","searchResult","id","getState","app","_id","a","b","result","user","currentUser","Object","keys","map","writeTop","every","number","actionRefreshRange","localRange","length"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,kBAAP,IAA4BC,oBAA5B,EAAkDC,KAAlD,QAA8D,UAA9D;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,YAAR,EAAsBC,QAAtB,QAAqC,wBAArC;AAGA,OAAO,MAAOC,UAAU,GAAG,YAAW;AAClC,MAAI;AACA,UAAMC,QAAQ,GAAI,MAAMJ,KAAK,CAACK,IAAN,CAAW,qCAAX,EAAiD,EAAjD,CAAxB;AAGA,QAAIC,KAAK,GAAGC,UAAU,CAACH,QAAQ,CAACI,IAAT,CAAcJ,QAAf,CAAtB;AACAL,IAAAA,KAAK,CAACU,QAAN,CAAeP,QAAQ,CAACI,KAAD,EAAOI,GAAG,CAACJ,KAAD,CAAV,CAAvB;AACAT,IAAAA,kBAAkB,CAAC,OAAD,EAASS,KAAT,CAAlB;AACAT,IAAAA,kBAAkB,CAAC,KAAD,EAAOa,GAAG,CAACJ,KAAD,CAAV,CAAlB;AAEH,GATD,CASE,OAAOK,CAAP,EAAU;AACRC,IAAAA,OAAO,CAACC,GAAR,CAAYF,CAAC,CAACP,QAAd;AACH;AAEJ,CAdM;;AAgBP,SAASG,UAAT,CAAoBO,OAApB,EAA6B;AACzBA,EAAAA,OAAO,GAAGC,IAAI,CAACD,OAAD,CAAd;AACA,MAAIE,SAAS,GAAG;AACZF,IAAAA,OAAO,EAAC,EADI;AAEZG,IAAAA,OAAO,EAAC,EAFI;AAGZC,IAAAA,SAAS,EAAC,EAHE;AAIZC,IAAAA,KAAK,EAAC;AAJM,GAAhB;AAMA,MAAIC,MAAM,GAAG;AACTN,IAAAA,OAAO,EAAC,GADC;AAETG,IAAAA,OAAO,EAAC,GAFC;AAGTC,IAAAA,SAAS,EAAC,GAHD;AAITC,IAAAA,KAAK,EAAC;AAJG,GAAb;AAMA,MAAIE,GAAG,GAAG;AACNP,IAAAA,OAAO,EAAC,EADF;AAENG,IAAAA,OAAO,EAAC,EAFF;AAGNC,IAAAA,SAAS,EAAC,EAHJ;AAINC,IAAAA,KAAK,EAAC;AAJA,GAAV;AAMAL,EAAAA,OAAO,CAACQ,OAAR,CAAiBC,IAAD,IAAQ;AACpB,QAAIH,MAAM,CAACG,IAAI,CAACC,IAAN,CAAN,KAAsBD,IAAI,CAACH,MAA3B,IAAqC,CAACJ,SAAS,CAACO,IAAI,CAACC,IAAN,CAAT,CAAqBC,QAArB,CAA8BF,IAAI,CAACH,MAAnC,CAA1C,EAAqF;AACjFC,MAAAA,GAAG,CAACE,IAAI,CAACC,IAAN,CAAH,CAAeE,IAAf,CAAoBH,IAApB;AACH;;AACDP,IAAAA,SAAS,CAACO,IAAI,CAACC,IAAN,CAAT,CAAqBE,IAArB,CAA0BH,IAAI,CAACH,MAA/B;AACAA,IAAAA,MAAM,CAACG,IAAI,CAACC,IAAN,CAAN,GAAoBD,IAAI,CAACH,MAAzB;AAEH,GAPD;AAQA,SAAO;AACHN,IAAAA,OAAO,EAAEO,GAAG,CAACP,OADV;AAEHG,IAAAA,OAAO,EAAEI,GAAG,CAACJ,OAFV;AAGHC,IAAAA,SAAS,EAAEG,GAAG,CAACH,SAHZ;AAIHC,IAAAA,KAAK,EAAEE,GAAG,CAACF;AAJR,GAAP;AAMH;;AAED,OAAO,MAAMQ,YAAY,GAAG,CAACC,EAAD,EAAIJ,IAAJ,KAAW;AACnC,MAAIlB,KAAK,GAAGP,KAAK,CAAC8B,QAAN,GAAiBC,GAAjB,CAAqBxB,KAArB,CAA2BkB,IAA3B,CAAZ;AACAlB,EAAAA,KAAK,CAACgB,OAAN,CAAeC,IAAD,IAAQ;AAClB,QAAIA,IAAI,CAACQ,GAAL,KAAaH,EAAjB,EACI,OAAOL,IAAP;AACP,GAHD;AAIH,CANM;;AAQP,SAASR,IAAT,CAAcM,GAAd,EAAmB;AACf,SAAOA,GAAG,CAACN,IAAJ,CAAS,CAACiB,CAAD,EAAGC,CAAH,KAAO;AACnB,WAAOA,CAAC,CAACC,MAAF,GAAWF,CAAC,CAACE,MAApB;AACH,GAFM,CAAP;AAGH;;AAGD,SAASxB,GAAT,CAAaJ,KAAb,EAAoB;AAChB,QAAMc,MAAM,GAAGrB,KAAK,CAAC8B,QAAN,GAAiBM,IAAjB,CAAsBC,WAAtB,CAAkCR,EAAjD;AAEA,MAAIlB,GAAG,GAAI;AACPI,IAAAA,OAAO,EAAC,CADD;AAEPG,IAAAA,OAAO,EAAE,CAFF;AAGPC,IAAAA,SAAS,EAAE,CAHJ;AAIPC,IAAAA,KAAK,EAAE;AAJA,GAAX;AAOAkB,EAAAA,MAAM,CAACC,IAAP,CAAY5B,GAAZ,EAAiB6B,GAAjB,CAAsBhB,IAAD,IAAQ;AACzBiB,IAAAA,QAAQ,CAACjB,IAAD,CAAR;AACH,GAFD;;AAIA,WAASiB,QAAT,CAAkBhB,IAAlB,EAAuB;AACnBlB,IAAAA,KAAK,CAACkB,IAAD,CAAL,CAAYiB,KAAZ,CAAkB,CAAClB,IAAD,EAAMmB,MAAN,KAAe;AAC7B,UAAInB,IAAI,CAACH,MAAL,KAAgBA,MAApB,EAA2B;AACvBV,QAAAA,GAAG,CAACc,IAAD,CAAH,GAAYkB,MAAM,GAAC,CAAnB;AACA,eAAO,KAAP;AACH;AACJ,KALD;AAMH;;AAED,SAAOhC,GAAP;AAGH;;AAED,OAAO,MAAMiC,kBAAkB,GAAG,MAAI;AAClC,QAAMrC,KAAK,GAAGP,KAAK,CAAC8B,QAAN,GAAiBC,GAAjB,CAAqBxB,KAAnC;AACA,QAAMsC,UAAU,GAAG9C,oBAAoB,CAAC,OAAD,CAAvC;AACA,MAAIuC,MAAM,CAACC,IAAP,CAAYhC,KAAZ,EAAmBuC,MAAnB,KAA8B,CAA9B,IAAmCR,MAAM,CAACC,IAAP,CAAYM,UAAZ,EAAwBC,MAAxB,KAAmC,CAA1E,EAA6E9C,KAAK,CAACU,QAAN,CAAeR,YAAY,EAA3B;AAChF,CAJM","sourcesContent":["import React from \"react\";\r\nimport saveToLocalStorage, {loadFromLocalStorage, store} from \"../store\";\r\nimport axios from \"axios\";\r\nimport {refreshRange, setRange} from \"../reducers/appReducer\";\r\n\r\n\r\nexport const  startRange = async () =>{\r\n    try {\r\n        const response =  await axios.post('http://localhost:5000/history/range',{\r\n        });\r\n\r\n        let range = printRange(response.data.response);\r\n        store.dispatch(setRange(range,top(range)));\r\n        saveToLocalStorage('range',range);\r\n        saveToLocalStorage('top',top(range));\r\n\r\n    } catch (e) {\r\n        console.log(e.response);\r\n    }\r\n\r\n}\r\n\r\nfunction printRange(history) {\r\n    history = sort(history);\r\n    let exception = {\r\n        history:[],\r\n        biology:[],\r\n        geography:[],\r\n        mixed:[]\r\n    }\r\n    let userId = {\r\n        history:'1',\r\n        biology:'1',\r\n        geography:'1',\r\n        mixed:'1'\r\n    }\r\n    let arr = {\r\n        history:[],\r\n        biology:[],\r\n        geography:[],\r\n        mixed:[]\r\n    };\r\n    history.forEach((item)=>{\r\n        if (userId[item.kind] !== item.userId && !exception[item.kind].includes(item.userId)){\r\n            arr[item.kind].push(item)\r\n        }\r\n        exception[item.kind].push(item.userId);\r\n        userId[item.kind] = item.userId;\r\n\r\n    });\r\n    return {\r\n        history: arr.history,\r\n        biology: arr.biology,\r\n        geography: arr.geography,\r\n        mixed: arr.mixed\r\n    };\r\n}\r\n\r\nexport const searchResult = (id,kind)=>{\r\n    let range = store.getState().app.range[kind];\r\n    range.forEach((item)=>{\r\n        if (item._id === id)\r\n            return item;\r\n    })\r\n}\r\n\r\nfunction sort(arr) {\r\n    return arr.sort((a,b)=>{\r\n        return b.result - a.result;\r\n    })\r\n}\r\n\r\n\r\nfunction top(range) {\r\n    const userId = store.getState().user.currentUser.id;\r\n\r\n    let top =  {\r\n        history:0,\r\n        biology: 0,\r\n        geography: 0,\r\n        mixed: 0\r\n    }\r\n\r\n    Object.keys(top).map((item)=>{\r\n        writeTop(item);\r\n    })\r\n\r\n    function writeTop(kind){\r\n        range[kind].every((item,number)=>{\r\n            if (item.userId === userId){\r\n                top[kind] = number+1\r\n                return false;\r\n            }\r\n        })\r\n    }\r\n\r\n    return top;\r\n\r\n\r\n}\r\n\r\nexport const actionRefreshRange = ()=>{\r\n    const range = store.getState().app.range;\r\n    const localRange = loadFromLocalStorage('range');\r\n    if (Object.keys(range).length === 0 && Object.keys(localRange).length !== 0) store.dispatch(refreshRange());\r\n}\r\n"]},"metadata":{},"sourceType":"module"}